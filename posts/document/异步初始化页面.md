一般情况下，只要在 ```_assets/state.js``` 文件中定义了 ```页面状态```，页面就可以根据预先定义好的状态进行初始化，此时，页面的初始化是一个同步过程。

但是在某些时候，页面的初始化是一个异步过程，比如通过网络从服务器端获取初始化状态，再利用这些状态对页面进行首次渲染。为了达到异步初始化的目的，在 ```cmis``` 中，开发者可以利用 ```页面生命周期方法``` 中提供的功能来对页面进行异步初始化。

## 在页面渲染前执行

在 ```cmis``` 的众多 ```页面生命周期方法```<sup>(注1)</sup> 中，```onBeforeEnter()``` 用于在页面渲染前对 ```页面状态``` 作出修改。

> 注1：关于 ```页面生命周期``` 的详细介绍请参考 ...。

编辑 ```_assets/controller.js``` 文件，修改后内容如下：

```javascript
/**
 * 生命周期方法由 cmis 运行时环境自动调用。
 * 同时其也是控制器函数，所以会被注入 $context 参数。
 * 
 * @param $conext 由 cmis 运行时注入的当前页面上下文对象
 * @return 如果返回一个Promise，则该页面的渲染会等待该 Promise 被 resolve 之后才进行。
 * 其他情况下，页面初始化将会同步进行。
 * /
export function onBeforeEnter($context) {
	return new Promise(resolve => {
		// 模拟异步获取数据，通常情况下，这里是一个 ajax 请求。
		setTimeout({
			$context.transition.setUser({
				name: 'test user'
			});
			
			// Promise必须被resolve
			resolve();
			
		// 延迟 3s
		}, 3000);
	});
}
```

修改状态 ```_assets/state.js``` 文件：

```javascript
export const appState = {
	// 预定义用户数据，该数据需要从服务器端获取，预设为 null
	user: null
};
```

修改 ```index.html``` 文件：

```html
<%@route path="/"%>

<!-- 绑定状态，虽然在 appState 中定义的 user 为null，
但是生命周期方法 onBeforeEnter 保证了在页面渲染时 appState 中的 user 一定会被修改成有意义的值 -->
<h1>欢迎你 {$appState.user.name}</h1>
```

## 预览效果

执行编译

```
cmis build
```

如果未启动开发服务器，则启动：

```
cmis start
```

打开浏览器，URL为：

```
http://localhost:3000
```

页面会在延迟大约 3 秒后显示出来。